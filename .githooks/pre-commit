#!/bin/bash

set -e

# Format Rust code
echo "Checking Rust formatting..."
if ! cargo fmt --all -- --check 2>/dev/null; then
    echo "Formatting Rust code..."
    cargo fmt --all
    echo "❌ Rust files were reformatted. Please re-stage and commit again."
    exit 1
fi
echo "✓ Rust formatting OK"

# Format TypeScript/React code
echo "Checking frontend formatting..."
cd apps/tars-desktop
if ! bun run prettier --check "src/**/*.{ts,tsx,js,jsx,json,css}" 2>/dev/null; then
    echo "Formatting frontend code..."
    bun run prettier --write "src/**/*.{ts,tsx,js,jsx,json,css}"
    echo "❌ Frontend files were reformatted. Please re-stage and commit again."
    exit 1
fi
echo "✓ Frontend formatting OK"

echo ""
echo "✓ All checks passed"
